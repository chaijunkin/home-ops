---
# yaml-language-server: $schema=https://k8s-schemas.bjw-s.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: ocis
spec:
  refreshInterval: 5m
  target:
    name: ocis-secret
    creationPolicy: Owner
    template:
      data:
        OCIS_JWT_SECRET: "{{ .ocis_jwt_secret }}"
        IDM_ADMIN_PASSWORD: "{{ .idm_admin_password }}"
        WEB_OIDC_CLIENT_ID: "{{ .ocis_service_account_id }}"
        NOTIFICATIONS_SMTP_PORT: "465"
        NOTIFICATIONS_SMTP_HOST: "{{ .SMTP_HOST }}"
        NOTIFICATIONS_SMTP_SENDER: "{{ .SMTP_SENDER }}"
        NOTIFICATIONS_SMTP_USERNAME: "{{ .SMTP_USERNAME }}"
        NOTIFICATIONS_SMTP_PASSWORD: "{{ .SMTP_PASSWORD }}"
        STORAGE_USERS_S3NG_ACCESS_KEY: "{{ .AWS_ACCESS_KEY_ID }}"
        STORAGE_USERS_S3NG_SECRET_KEY: "{{ .AWS_SECRET_ACCESS_KEY }}"
        # OCIS_LDAP_URI: 'ldap://lldap.security.svc.cluster.local:3890'
        # OCIS_LDAP_INSECURE: "true"
        # OCIS_LDAP_BIND_DN: uid={{ .LLDAP_READWRITE_ADMIN_USERNAME }},ou=people,dc=zed,dc=gay
        # OCIS_LDAP_BIND_PASSWORD: '{{ .LLDAP_READWRITE_ADMIN_PASSWORD }}'
        # OCIS_ADMIN_USER_ID: "{{ .LLDAP_READWRITE_ADMIN_UUID }}"

        # OCIS_LDAP_USER_ENABLED_ATTRIBUTE: uid
        # GRAPH_LDAP_SERVER_WRITE_ENABLED: "true"
        # GRAPH_LDAP_REFINT_ENABLED: "false"
        # OCIS_EXCLUDE_RUN_SERVICES: idm
        # IDP_LDAP_UUID_ATTRIBUTE_TYPE: 'text'

        # LDAP_LOGIN_ATTRIBUTES: "uid"
        # IDP_LDAP_LOGIN_ATTRIBUTE: "uid"
        # IDP_LDAP_UUID_ATTRIBUTE: "entryuuid"
        # OCIS_LDAP_USER_SCHEMA_ID: "entryuuid"
        # OCIS_LDAP_GROUP_SCHEMA_ID: "uid"
        # OCIS_LDAP_GROUP_SCHEMA_GROUPNAME: "uid"

        # OCIS_LDAP_GROUP_BASE_DN: "ou=groups,dc=zed,dc=gay"
        # OCIS_LDAP_GROUP_OBJECTCLASS: "groupOfUniqueNames"
        # OCIS_LDAP_GROUP_FILTER: "(objectclass=groupOfUniqueNames)"

        # OCIS_LDAP_USER_BASE_DN: "ou=people,dc=zed,dc=gay"
        # OCIS_LDAP_USER_OBJECTCLASS: "inetOrgPerson"
        # OCIS_LDAP_USER_FILTER: "(objectclass=inetOrgPerson)"

        # COLLABORATION_WOPI_SECRET: "{{ .ONLYOFFICE_JWT_SECRET }}"
  data:
    ## SMTP
    - secretKey: SMTP_HOST
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 613150cc-5dcb-4b3e-881e-27cf5dbcad7e
        property: SMTP_HOST
    - secretKey: SMTP_USERNAME
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 613150cc-5dcb-4b3e-881e-27cf5dbcad7e
        property: SMTP_USERNAME
    - secretKey: SMTP_PASSWORD
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 613150cc-5dcb-4b3e-881e-27cf5dbcad7e
        property: SMTP_PASSWORD
    - secretKey: SMTP_SENDER
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 613150cc-5dcb-4b3e-881e-27cf5dbcad7e
        property: SMTP_FROM
    - secretKey: ocis_jwt_secret
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e62c9502-0c7b-4908-a5fd-42d15e269e2d
        property: ocis_jwt_secret
    - secretKey: ocis_service_account_id
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e62c9502-0c7b-4908-a5fd-42d15e269e2d
        property: ocis_oauth_client_id
    - secretKey: idm_admin_password
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: e62c9502-0c7b-4908-a5fd-42d15e269e2d
        property: password
    - secretKey: AWS_ACCESS_KEY_ID
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: d10ce5c3-ce4b-4f22-9430-b962390e0cba
        property: owner_access_key
    - secretKey: AWS_SECRET_ACCESS_KEY
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: d10ce5c3-ce4b-4f22-9430-b962390e0cba
        property: owner_secret_key
